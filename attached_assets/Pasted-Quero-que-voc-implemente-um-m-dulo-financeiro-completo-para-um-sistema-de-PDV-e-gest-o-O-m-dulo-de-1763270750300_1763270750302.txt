Quero que vocÃª implemente um mÃ³dulo financeiro completo para um sistema de PDV e gestÃ£o.
O mÃ³dulo deve incluir a lÃ³gica de: Caixa, LanÃ§amentos Financeiros, Despesas, Receitas e RelatÃ³rios.
Siga as regras abaixo Ã  risca para garantir consistÃªncia e precisÃ£o no fluxo financeiro.

ğŸ“Œ 1. Estrutura de Dados ObrigatÃ³ria
1.1. Caixa

Crie a tabela/estrutura:

id_caixa
data_abertura
hora_abertura
valor_inicial
status (aberto / fechado)
data_fecho
hora_fecho
saldo_final
observacoes

1.2. LanÃ§amentos Financeiros

Cada movimento deve gerar um lanÃ§amento:

id_lancamento
id_caixa (nullable)
data
hora
tipo (receita, despesa, ajuste)
origem (pdv, web, manual)
categoria
descricao
valor
metodo_pagamento (dinheiro, tpa, transferencia, multicaixa, crÃ©ditoâ€¦)
referencia (id_pedido, id_despesaâ€¦)

1.3. Despesas
id_despesa
descricao
categoria
valor
data
pagamento (dinheiro, transferencia, tpa)
id_lancamento (vinculado automaticamente)

ğŸ“Œ 2. Regras Gerais do Sistema (ESSENCIAL)
2.1. Tudo Ã© um lanÃ§amento financeiro

Cada venda, despesa ou ajuste deve obrigatoriamente gerar um lanÃ§amento financeiro.

*2.2. O caixa sÃ³ controla movimentos em dinheiro

Se o mÃ©todo for:

Dinheiro â†’ entra no caixa

TPA, transferÃªncia, multicaixa â†’ nÃ£o entram no caixa

ğŸ“Œ 3. LÃ³gica Detalhada de Funcionamento
3.1. Abertura do Caixa

Ao abrir o caixa:

Registrar valor inicial

Criar o registro do caixa

Gerar lanÃ§amento automÃ¡tico:

tipo: ajuste
descricao: abertura do caixa
valor: +valor_inicial
metodo_pagamento: dinheiro
id_caixa: caixa_aberto

3.2. Venda no PDV

Ao finalizar um pedido:

Se o pagamento Ã© em dinheiro:
tipo: receita
origem: pdv
categoria: venda
valor: total_pago
metodo_pagamento: dinheiro
id_caixa: caixa_aberto

Se o pagamento Ã© TPA / transferÃªncia / multicaixa:
tipo: receita
origem: pdv
categoria: venda
valor: total_pago
metodo_pagamento: tpa / transferencia
id_caixa: NULL


Apenas vendas em dinheiro influenciam o saldo do caixa.

3.3. Registrar Despesa

Ao criar uma despesa, sempre criar o lanÃ§amento financeiro vinculado.

Despesa paga com dinheiro

Sai do caixa.

tipo: despesa
valor: -X
metodo_pagamento: dinheiro
id_caixa: caixa_aberto

Despesa paga por transferÃªncia, TPA, multibanco

NÃ£o afeta o caixa.

tipo: despesa
valor: -X
metodo_pagamento: transferencia
id_caixa: NULL

3.4. Ajustes Manuais no Caixa
Entrada manual:
tipo: ajuste
valor: +X
metodo: dinheiro
id_caixa: caixa_aberto

SaÃ­da manual:
tipo: ajuste
valor: -X
metodo: dinheiro
id_caixa: caixa_aberto
descricao: retirada

ğŸ“Œ 4. Fecho do Caixa

Ao fechar:

Somar todos os lanÃ§amentos com id_caixa = X

Calcular:

saldo = valor_inicial + receitas - despesas + ajustes


Operador informa o dinheiro fÃ­sico

Registrar:

saldo_final
diferenca (informado - calculado)


Caixa muda para status "fechado"

ğŸ“Œ 5. RelatÃ³rios ObrigatÃ³rios

Gerar os seguintes:

Vendas por perÃ­odo

Ticket mÃ©dio

MovimentaÃ§Ã£o por mÃ©todo de pagamento

Receita vs despesa

Fechos de caixa por dia

Ranking de produtos

RelatÃ³rio financeiro consolidado (baseado nos lanÃ§amentos)

ğŸ“Œ 6. Regras adicionais

Um caixa sÃ³ pode existir 1 por operador por dia (opcional, se quiser).

NÃ£o permitir registrar despesas em dinheiro se nÃ£o houver caixa aberto.

Todo pagamento deve gerar lanÃ§amento automaticamente.

Nenhum lanÃ§amento em dinheiro pode existir sem estar vinculado a um caixa.